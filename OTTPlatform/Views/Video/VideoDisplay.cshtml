

@model OTTPlatform.Models.Videos
@{
    Layout = null;
}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">


<style>
    body {
        background-color: #121212;
        color: #ffffff;
        font-family: 'Poppins', sans-serif;
    }

    .card {
        background-color: #1e1e1e;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        color: #ffffff;
        margin-top: 50px;
    }

    .card-body {
        padding: 20px;
    }

    h1, h3 {
        color: #f8f9fa;
        font-weight: 600;
    }

    p {
        color: #bdbdbd;
    }

    video {
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    #VideoDisplay {
        margin-top: 20px;
    }

    .header-section {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 20px;
    }

    .header-section h1, .header-section h4 {
        margin: 0;
    }

    #starRating .star {
        cursor: pointer;
        font-size: 24px;
        transition: color 0.2s ease-in-out;
    }

        #starRating .star:hover,
        #starRating .star.active {
            color: gold;
        }
</style>



<div class="container">
    <div class="header-section">
        <div>
            <h1>Enjoy your Movie !!</h1>
        </div>
        <div>
            <h4>Welcome, @ViewBag.User.UserName!</h4>
            <a href="/Login/LoginPage" class="me-3" onclick="handleSignOut()">Sign out</a>
        </div>
    </div>
    <div class="card">
        <div class="card-body">
            <div class="row">
                <div class="col-md-8">
                    <video width="100%" controls poster="@Url.Content(ViewBag.videos.TemplateURL)">
                        <source src="@Url.Content(ViewBag.videos.VideoURL)" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <input type="hidden" id="VideoID" value="@ViewBag.videos.Id" class="form-control" />
                    <input type="hidden" id="UserID" value="@ViewBag.User.Id" class="form-control" />

                </div>

                <div class="col-md-4">
                    <h3 class="mt-3">@ViewBag.videos.VideoName</h3>
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                        <span>@ViewBag.videos.CategoryName - (@ViewBag.videos.LanguageName)</span>
                        <div style="display: flex; align-items: center;>
                            @for (int i = 0; i <= 5; i++)
                            {
                            if (i <= ViewBag.videos.Ratings)
                            {
                            <i class="bi bi-star-fill text-warning" style="font-size: 14px;"></i>
                            }
                            else
                            {
                            <i class="bi bi-star text-secondary" style="font-size: 14px;"></i>
                            }
                            }
                            <span>(@ViewBag.videos.RatingsCount)</span>
                        </div>

                    </div>
                    <p>@ViewBag.videos.VideoDescription</p>


                    <div style="background: #292929; border-radius: 8px; padding: 10px; max-height: 200px; overflow-y: scroll; margin-bottom: 15px;">
                        @foreach (var comment in ViewBag.comments)
                        {
                            <div style="margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #444;">
                                <p style="margin: 0; color: #007bff; font-weight: bold;">@comment.UserName</p>
                                <div style="margin: 5px 0;">
                                    @for (int i = 1; i <= 5; i++)
                                    {
                                        if (i <= comment.Ratings)
                                        {
                                            <i class="bi bi-star-fill text-warning" style="font-size: 14px;"></i>
                                        }
                                        else
                                        {
                                            <i class="bi bi-star text-secondary" style="font-size: 14px;"></i> 
                                        }
                                    }
                                </div>
                                <span style="color: #bdbdbd;">@comment.CommentsName</span>
                            </div>
                        }
                    </div>
@*                     <div class="form-group">
                  *@ <div id="starRating">
                        <i class="bi bi-star-fill text-secondary star" data-value="1" onclick="updateRating(1)" style="cursor: pointer; font-size: 24px;"></i>
                        <i class="bi bi-star-fill text-secondary star" data-value="2" onclick="updateRating(2)" style="cursor: pointer; font-size: 24px;"></i>
                        <i class="bi bi-star-fill text-secondary star" data-value="3" onclick="updateRating(3)" style="cursor: pointer; font-size: 24px;"></i>
                        <i class="bi bi-star-fill text-secondary star" data-value="4" onclick="updateRating(4)" style="cursor: pointer; font-size: 24px;"></i>
                        <i class="bi bi-star-fill text-secondary star" data-value="5" onclick="updateRating(5)" style="cursor: pointer; font-size: 24px;"></i>
                    </div>
                    <input type="hidden" id="ratingValue" value="0">

                        <input type="text"
                               id="VideoComments"
                               name="VideoComments"
                               class="form-control"
                               placeholder="Write your comment here..."
                               style="color: black; border-radius: 5px; padding: 10px; margin-bottom: 10px;" />
                        <button type="button"
                                id="submitComment"
                                class="btn btn-primary"
                                style="background: #007bff; border: none; width: 100%; padding: 10px; border-radius: 5px; transition: background-color 0.3s ease;">
                            Submit
                        </button>
@*                     </div>
 *@                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
@{
    await Html.RenderPartialAsync("_ValidationScriptsPartial");
}
<script>

    $(document).ready(function () {

        

        $('#submitComment').click(function () {
            var videoId = $('#VideoID').val()
            var UserId = $('#UserID').val()
            var rating = $('#ratingValue').val();
            var Comments= $('#VideoComments').val()

            if (!rating || rating === '0') {
                alert('Please select a rating.');
                return;
            }

            if (!Comments || Comments === null) {
                alert('Please enter Comment.');
                return;
            }


            var videoData = {
                VideoID: videoId,
                CommentsName: Comments,
                Ratings: parseInt(rating, 10),
                UserID: UserId
               
            };

            $.ajax({
                url: '/Video/VideoComments',
                type: 'POST',
                data: videoData,
                success: function (response) {
                    alert('Comment updated successfully!');
                    location.reload();
                },
                error: function (xhr, status, error) {
                    alert('Failed to update the comment. Please try again.');
                    console.error(error);
                }
            });
        });
       

        function handleSignOut() {
            sessionStorage.clear();
            localStorage.clear();
            window.location.href = "/Login/LoginPage";
        }

       
    });
    function updateRating(selectedRating) {
        $('#ratingValue').val(selectedRating);

        $('#starRating .star').each(function () {
            if ($(this).data('value') <= selectedRating) {
                $(this).removeClass('text-secondary').addClass('text-warning');
            } else {
                $(this).removeClass('text-warning').addClass('text-secondary');
            }
        });
    }
</script>




